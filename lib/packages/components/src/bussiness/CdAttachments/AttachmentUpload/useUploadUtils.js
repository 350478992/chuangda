"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const d=require("@/api/system"),_=require("@/util/bussTool");function q(){const g={qiye:"/a/stone/attachment/mobile-upload/qrcode-image",mis:"/api/equipment-documents/mobile-upload/qrcode-image"},m=(t,s="mis")=>{const{attitle:e,attClass:n,attCategory:a,attrefsysid:c,atttype:o}=t,r=e?encodeURI(e):"",i=n?encodeURI(n):"",u=a?encodeURI(a):"",l=c?encodeURI(c):"",$=o?encodeURI(o):"",f=_.getSidToken(),S=g[s];return`${window.$baseRequestUrl}${S}?attitle=${r}&attClass=${i}&attCategory=${u}&attrefsysid=${l}&atttype=${$}&__sid=${f}`},y=t=>new Promise((s,e)=>{try{Promise.resolve().then(()=>require("../../../../../../node_modules/.pnpm/ali-oss@6.17.1/node_modules/ali-oss/dist/aliyun-oss-sdk.js")).then(n=>n.aliyunOssSdk).then(n=>{const a=n.default;d.getAttachmentConfigs(t).then(c=>{const{accessKeyId:o,accessKeySecret:r,bucket:i,endpoint:u}=c.data,l=new a({accessKeyId:o,accessKeySecret:r,bucket:i,endpoint:u});s({ossInstance:l,config:c.data})})})}catch(n){e(n),window.$Message.warning(n)}}),p=()=>{const t=new Date,s=t.getFullYear(),e=t.getMonth()+1,n=t.getDate(),a=t.getHours(),c=t.getMinutes(),o=t.getSeconds();return""+s+e+n+a+c+o},h=t=>{let s=t.lastIndexOf("."),e="";return s!==-1&&(e=t.substring(s)),e};return{initOSS:y,uploadByOSS:(t,s,e)=>new Promise((n,a)=>{let c="";s.itemvalue&&(c+=`${s.itemvalue}/`),c+=`${p()}${Math.floor(Math.random()*1e4)}${h(e.file.name)}`;try{t.put(c,e.file).then(o=>{const r=o.url||`'http://${o.bucket}.${s.endpoint}/${o.name}`;Object.assign(e,{datasource:s.datasource,attfileroute:r,attname:e.file.name}),n(e)})}catch(o){a(o)}}),uploadRequest:(t,s)=>new Promise((e,n)=>{d.uploadAttachment(t,s).then(a=>{e(a)}).catch(a=>{n(a)})}),getQrcodeImgSrc:m}}exports.default=q;
